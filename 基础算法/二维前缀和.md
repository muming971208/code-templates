# 二维前缀和

## 问题描述

给出一个$m\times n$的矩阵mat以及四个整数$r_1,r_2,c_1,c_2(0\le r_1 \le r_2 <m,0\le c_1 \le c_2 <n)$，求$\sum_{i=r_1}^{r_2}\sum_{j=c_1}^{c_2}mat[i][j]$的值。

## 简析

定义一个$(m+1)\times (n+1)$的矩阵p存储mat的二维前缀和，即令$p[i][j]$表示$\sum_{r=0}^{i-1}\sum_{c=0}^{j-1}mat[i][j]$的值，其中，$0<i<m+1,0<j<n+1$。可以用递推公式$p[i][j] = p[i - 1][j] + p[i][j - 1] - p[i - 1][j - 1] + mat[i - 1][j - 1]$对$p[i][j]$进行计算。建立二维前缀和数组的时间复杂度为$O(mn)$。

那么，题目要求的解为$p[r2+1][c2+1]-p[r1][c2+1]-p[r2+1][c1]+p[r1][c1]$，建立好二维前缀和数组后，每次查询的时间复杂度为$O(1)$。

## C++代码

```cpp
vector<vector<gg>> preSum(MAX, vector<gg>(MAX));  //前缀和数组
//计算前缀和
void getPrefixSum(vector<vector<gg>>& mat) {
    for (gg i = 1; i < ni + 1; ++i) {
        for (gg j = 1; j < mi + 1; ++j) {
            preSum[i][j] = preSum[i - 1][j] + preSum[i][j - 1] - preSum[i - 1][j - 1] + mat[i - 1][j - 1];
        }
    }
}
//计算将左上角为(a,b)，右下角为(c,d)的矩阵的和
gg getSum(gg r1, gg c1, gg r2, gg c2) {
    return preSum[r2 + 1][c2 + 1] - preSum[r1][c2 + 1] - preSum[r2 + 1][c1] + preSum[r1][c1];
}
```