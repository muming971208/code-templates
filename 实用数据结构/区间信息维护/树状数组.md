# 树状数组

## 概述

树状数组又称二叉索引树，简称BIT，是算法竞赛中常用的用来维护区间信息的数据结构。树状数组中，下标均从1开始。getSum和update操作时间复杂度均为$O(log n)$。

## lowbit

在计算机中，一个补码表示的整数x变成其相反数-x的过程相当于把x的二进制的每一位都取反， 然后末位加1，而这等价于**直接把x的二进制最右边的1左边的每一位都取反**。因此`lowbits(x)=x&(-x)`表示就是把x的二进制最右边的1左边的每一位都置为0得到的结果，它的值是能整除x的最大2的幂次数。

## 单点修改，区间查询

```cpp
inline gg lowbit(gg x) { return x & (-x); };
vector<gg> c(MAX);
//实现将A[x] + v的功能
void update(gg x, gg v) {
    for (gg i = x; i <= ni; i += lowbit(i)) {
        c[i] += v;
    }
}
//求A[1]~A[x]之和
gg getSum(gg x) {
    gg sum = 0;
    for (gg i = x; i > 0; i -= lowbit(i)) {
        sum += c[i];
    }
    return sum;
}
```

## 区间修改，单点查询

update和getSum函数与`单点修改，区间查询`完全一致，但是需要使用差分建树和查询，下面的代码在`单点修改，区间查询`的基础上进行了进一步的封装。

```cpp
inline gg lowbit(gg x) { return x & (-x); };
vector<gg> c(MAX);
void update(gg x, gg v) {
    for (gg i = x; i <= ni; i += lowbit(i)) {
        c[i] += v;
    }
}
//利用差分建树
void build(vector<gg>& v) {
    for (gg i = 1; i <= ni; ++i) {
        update(i, v[i] - v[i - 1]);
    }
}
//将区间[l,r]都加上v
void modify(gg l, gg r, gg v) {
    update(l, v);
    update(r + 1, -v);
}
//求A[x]
gg getSum(gg x) {
    gg sum = 0;
    for (gg i = x; i > 0; i -= lowbit(i)) {
        sum += c[i];
    }
    return sum;
}
```

## 区间修改，区间查询